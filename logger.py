import time

class Logger:

    def _log(self, msg, sym, start_timer = None, end_timer = None):

        if self.print_log is True:
        
            _time = None
            if start_timer is not None:

                t = time.time()
                self.time_dict.update({start_timer: t})

            if end_timer is not None:

                t = time.time()
                _time = t - self.time_dict[end_timer]
                self.time_dict.pop(end_timer, None)
            
            if _time is not None:
                print(f"{sym} [{self.session_name}] [{round(_time, 4)} s] {msg}")
            else:
                print(f"{sym} [{self.session_name}] [] {msg}")

    def log_info(self, msg, start_timer = None, end_timer = None):
        self._log(msg, sym = "[i]", start_timer = start_timer, end_timer = end_timer)

    def log_warning(self, msg, start_timer = None, end_timer = None):
        self._log(msg, sym = "[!]", start_timer = start_timer, end_timer = end_timer)

    def log_success(self, msg, start_timer = None, end_timer = None):
        self._log(msg, sym = "[*]", start_timer = start_timer, end_timer = end_timer)

    def __init__(self, session_name = "LOG", print_log = True):

        def _estimate_time_overhead():

            RND_CNT = 10000

            _d = {}

            total_overhead = 0
            for i in range(RND_CNT):

                s = f"s{i}"
                if s is not None:

                    t = time.time()
                    _d.update({s: t})

                s_end = f"s{i}"
                if s_end is not None:

                    t = time.time()
                    total_overhead += t - _d[s]

            return total_overhead / RND_CNT

        self.session_name = session_name
        self.print_log = print_log

        self.time_dict = {}
        self._mean_timer_overhead = _estimate_time_overhead()